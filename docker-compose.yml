version: '3.8'

services:
  # 1. ‚öôÔ∏è ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Backend (Node.js/Express)
  app:
    build: .
    container_name: per-project-app 
    restart: always
    # ‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á MONGO_URI
    env_file:
      - ./.env 
    volumes:
      - .:/app
      - /app/node_modules # ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ overwrite node_modules
    working_dir: /app
    # ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏±‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
    command: ["node", "src/server.js"] 
    # ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ depends_on database ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô external service
    networks:
      - per_network

  # 2. üåê ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Reverse Proxy (Nginx)
  nginx:
    image: nginx:latest
    container_name: per-project-nginx
    volumes:
      - ./nginx-test5.conf:/etc/nginx/conf.d/default.conf:ro
      - ./public:/usr/share/nginx/html/public:ro
    # ‡πÄ‡∏õ‡∏¥‡∏î Port 63 ‡∏Ç‡∏≠‡∏á Host ‡∏™‡∏π‡πà Port 80 ‡∏Ç‡∏≠‡∏á Nginx Container
    ports:
      - "63:80" 
    # Nginx ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á app
    depends_on:
      - app 
    restart: always
    networks:
      - per_network

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Network ‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô
networks:
  per_network:
    driver: bridge